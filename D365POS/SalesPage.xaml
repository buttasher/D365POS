<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="D365POS.SalesPage"
             xmlns:controls="clr-namespace:D365POS.Controls"
             Title="Sales">


    <Grid x:Name="MainContainer">

        <Grid x:Name="SalesContent" RowDefinitions="Auto,Auto,*" Padding="10">


            <SearchBar x:Name="ProductSearchBar"
                       Grid.Row="0"
                       Placeholder="Search by barcode, ID, or item name"
                       TextChanged="OnSearchTextChanged"
                       HeightRequest="45"
                       Margin="0,0,0,5"/>


            <Grid Grid.Row="2" ColumnDefinitions="5*,3*" Padding="0">

                <!-- LEFT SIDE -->
                <Grid Grid.Column="0" RowDefinitions="*,Auto" Margin="0,0,20,0">

                    <!-- Product Table -->
                    <Frame Grid.Row="0" Padding="10">
                        <Grid RowDefinitions="Auto,*" RowSpacing="10">
                            <Grid Grid.Row="0" ColumnDefinitions="*,4*,2*,*,*" Padding="5">
                                <Label Text="Bar code" FontAttributes="Bold" Grid.Column="0"/>
                                <Label Text="Item" FontAttributes="Bold" Grid.Column="1"/>
                                <Label Text="Quantity" FontAttributes="Bold" Grid.Column="2"/>
                                <Label Text="UOM" FontAttributes="Bold" Grid.Column="3"/>
                                <Label Text="Total" FontAttributes="Bold" Grid.Column="4"/>
                            </Grid>

                            <CollectionView x:Name="ProductsList"
                                            Grid.Row="1"
                                            ItemsSource="{Binding AddedProducts}"
                                            SelectionMode="Single"
                                            SelectionChanged="OnProductSelectedFromList">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="*,4*,2*,*,*" Padding="5" BackgroundColor="{Binding IsVoid, Converter={StaticResource BoolToGrayConverter}}">
                                            <Label Text="{Binding ItemBarCode}" Grid.Column="0"/>
                                            <Label Text="{Binding Description}" Grid.Column="1"/>
                                            <Label Text="{Binding Quantity}" Grid.Column="2" HorizontalTextAlignment="Start"/>
                                            <Label Text="{Binding UnitId}" Grid.Column="3"/>
                                            <Label Text="{Binding Total, StringFormat='{0:N3}'}" Grid.Column="4"/>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </Grid>
                    </Frame>

                    <!-- Customer + Totals -->
                    <Frame Grid.Row="1" Padding="15" Margin="0,10,0,0">
                        <StackLayout Spacing="15">
                            <Label Text="Add customer to this transaction" FontAttributes="Bold"/>
                            <Button Text="Add customer"
                                    BackgroundColor="#A66E43"
                                    CornerRadius="8"
                                    HorizontalOptions="Start"/>
                            <Grid ColumnDefinitions="*,*,*,*" RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                                <Label Text="Lines" Grid.Row="0" Grid.Column="0"/>
                                <Label Text="{Binding LinesCount}" Grid.Row="0" Grid.Column="1"/>

                                <Label Text="Total" Grid.Row="0" Grid.Column="2" HorizontalOptions="End"/>
                                <Label Text="{Binding TotalSubtotal, StringFormat='{0:N3}'}" Grid.Row="0" Grid.Column="3" HorizontalOptions="End"/>

                                <Label Text="Discounts" Grid.Row="1" Grid.Column="0"/>
                                <Label Text="0.000" Grid.Row="1" Grid.Column="1"/>

                                <Label Text="Payments" Grid.Row="1" Grid.Column="2" HorizontalOptions="End"/>
                                <Label x:Name="PaymentLabel" Text="0.000" Grid.Row="1" Grid.Column="3" HorizontalOptions="End"/>

                                <Label Text="Tax" Grid.Row="2" Grid.Column="0"/>
                                <Label Text="{Binding TotalTax, StringFormat='{0:N3}'}" Grid.Row="2" Grid.Column="1"/>

                                <Label Text="Amount due" TextColor="#A66E43" FontAttributes="Bold" Grid.Row="2" Grid.Column="2" HorizontalOptions="End"/>
                                <Label x:Name="AmountDueLabel" Text="0.000" TextColor="#A66E43" FontAttributes="Bold" Grid.Row="2" Grid.Column="3" HorizontalOptions="End"/>
                            </Grid>
                        </StackLayout>
                    </Frame>
                </Grid>

                <!-- RIGHT SIDE (buttons remain unchanged) -->
                <Grid Grid.Column="1" RowDefinitions="*,Auto" RowSpacing="10">
                    <Grid Grid.Row="0"
                          ColumnDefinitions="*,*"
                          RowDefinitions="Auto,Auto,Auto,Auto,Auto"
                          ColumnSpacing="10"
                          RowSpacing="10"
                          Margin="0,20,0,0">

                        <Button Grid.Row="0" Grid.Column="0" Text="Set quantity" BackgroundColor="#A66E43" HeightRequest="60" Clicked="OnSetButtonClicked"/>
                        <Button Grid.Row="0" Grid.Column="1" Text="Change unit of measure" BackgroundColor="#A66E43" HeightRequest="60"/>
                        <Button Grid.Row="1" Grid.Column="0" Text="Void product" BackgroundColor="#A66E43" HeightRequest="60" Clicked="OnVoidProductClicked"/>
                        <Button Grid.Row="1" Grid.Column="1" Text="Void transaction" BackgroundColor="#A66E43" HeightRequest="60" Clicked="OnVoidTransactionClicked"/>
                        <Button Grid.Row="2" Grid.Column="0" Text="Transaction comment reports" BackgroundColor="#A66E43" HeightRequest="60"/>
                        <Button Grid.Row="2" Grid.Column="1" Text="View reports" BackgroundColor="#A66E43" HeightRequest="60"/>
                        <Button Grid.Row="3" Grid.Column="0" Text="Suspend transaction" BackgroundColor="#A66E43" HeightRequest="60"/>
                        <Button Grid.Row="3" Grid.Column="1" Text="Void payment" BackgroundColor="#A66E43" HeightRequest="60"/>
                        <Button Grid.Row="4" Grid.Column="0" Text="Price check" BackgroundColor="#A66E43" HeightRequest="60"/>
                        <Button Grid.Row="4" Grid.Column="1" Text="Recall transaction" BackgroundColor="#A66E43" HeightRequest="60"/>

                    </Grid>

                    <!-- Payment Buttons -->
                    <Grid Grid.Row="1"
                          ColumnDefinitions="*,*"
                          RowDefinitions="Auto,Auto"
                          ColumnSpacing="10"
                          RowSpacing="10">
                        <Button Grid.Row="0" Grid.Column="0" Text="Pay Cash" BackgroundColor="#A66E43" HeightRequest="60" Clicked="OnPayCashClicked"/>
                        <Button Grid.Row="0" Grid.Column="1" Text="Pay Card" BackgroundColor="#A66E43" HeightRequest="60" Clicked="OnPayCardClicked"/>
                        <Button Grid.Row="1" Grid.Column="0" Text="Pay Quick Cash" BackgroundColor="#A66E43" HeightRequest="60" Clicked="OnPayQuickCashClicked"/>
                        <Button Grid.Row="1" Grid.Column="1" Text="Pay Customer Account" BackgroundColor="#A66E43" HeightRequest="60"/>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>

        <!-- ======================================== -->
        <!-- 2️⃣ FULL-SCREEN SEARCH OVERLAY -->
        <!-- ======================================== -->
        <Grid x:Name="SearchOverlay"
              IsVisible="{Binding IsSearchListVisible}"
              Padding="10,60,10,10"
              RowDefinitions="Auto,*"
              VerticalOptions="Start"
              ZIndex="1">

            <Frame CornerRadius="10"
                   Padding="5"
                   HasShadow="True">

                <CollectionView x:Name="SearchResultsList"
                                ItemsSource="{Binding FilteredProducts}"
                                SelectionMode="Single"
                                SelectionChanged="OnProductSelected"
                                HeightRequest="300">
                    <CollectionView.Header>
                        <Grid Padding="10" ColumnDefinitions="2*,*,*,Auto">
                            <Label Text="Item Name" FontAttributes="Bold"/>
                            <Label Text="Item Id" FontAttributes="Bold" Grid.Column="1"/>
                            <Label Text="Barcode" FontAttributes="Bold" Grid.Column="2"/>
                            <Label Text="Unit" FontAttributes="Bold" Grid.Column="3"/>
                        </Grid>
                    </CollectionView.Header>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="10" Margin="0,1" ColumnDefinitions="2*,*,*,Auto">
                                <Label Text="{Binding Description}" />
                                <Label Text="{Binding ItemId}" Grid.Column="1" />
                                <Label Text="{Binding ItemBarCode}" Grid.Column="2" />
                                <Label Text="{Binding UnitId}" Grid.Column="3" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Frame>
        </Grid>

    </Grid>
</ContentPage>
